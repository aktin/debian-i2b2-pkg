#!/bin/bash
#--------------------------------------
# Script Name:  preinst
# Version:      1.0
# Authors:      akombeiz@ukaachen.de
# Date:         30 Oct 24
# Purpose:      Pre-installation script for 'aktin-notaufnahme-i2b2'.
#               Checks for dependencies, prepares backups, and stops conflicting services if upgrading.
#--------------------------------------

readonly OPERATION="${1}"

check_ubuntu_version() {
  local ubuntu_version
  ubuntu_version=$(lsb_release -rs)
  if [[ "${ubuntu_version}" != "__UBUNTU_VERSION__" ]]; then
    echo "Warning: This package is optimized for Ubuntu __UBUNTU_VERSION__. Detected version: ${ubuntu_version}"
  fi
}

main() {
  set -euo pipefail
  case "$OPERATION" in
    install)
      # Runs before the package is installed for the first time.
      check_ubuntu_version
      ;;
    upgrade)
      # Runs before upgrading the package to a new version.
      check_ubuntu_version
      ;;
    abort-upgrade)
      # Used if an upgrade fails and needs rollback steps.
      ;;
    abort-install)
      # Runs if the initial installation is interrupted or fails.
      ;;
  esac
}

main "$@"
